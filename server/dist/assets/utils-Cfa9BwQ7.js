const a=window.location.hostname,S=window.location.protocol;let u="";a==="localhost"||a==="127.0.0.1"?u=`${S}//localhost:5443`:a.startsWith("10.")||a.startsWith("192.168.")?S==="https:"?u=`https://${a}:5443`:u=`http://${a}:5000`:u=window.location.origin;async function P(n,c={}){const e=`${u}${n}`;try{return await fetch(e,{...c,credentials:"include",mode:"cors"})}catch(t){return console.error("âŒ Network error:",t),{ok:!1,status:0,json:async()=>({success:!1,error:"offline"})}}}const p="gramam-db-v4",x=4,i="products",r="bills",m="users";function f(){return new Promise((n,c)=>{const e=indexedDB.open(p,x);e.onupgradeneeded=t=>{const o=t.target.result;if(o.objectStoreNames.contains(i)||o.createObjectStore(i,{keyPath:"id"}),!o.objectStoreNames.contains(r))o.createObjectStore(r,{keyPath:"invoiceId"}).createIndex("synced","synced",{unique:!1});else{const d=t.target.transaction.objectStore(r);d.indexNames.contains("synced")||d.createIndex("synced","synced",{unique:!1})}o.objectStoreNames.contains(m)||o.createObjectStore(m,{keyPath:"username"})},e.onsuccess=()=>n(e.result),e.onerror=()=>c(e.error)})}async function j(n=[]){const e=(await f()).transaction(i,"readwrite"),t=e.objectStore(i);return t.clear(),n.forEach(o=>t.put(o)),new Promise(o=>e.oncomplete=()=>o(!0))}async function g(){const e=(await f()).transaction(i,"readonly").objectStore(i);return new Promise(t=>{const o=e.getAll();o.onsuccess=()=>t(o.result||[]),o.onerror=()=>t([])})}const I=g;async function E(n){if(!n||!n.invoiceId)throw new Error("Missing invoiceId");const e=(await f()).transaction(r,"readwrite");return e.objectStore(r).put({...n,synced:!1,createdAt:new Date().toISOString()}),new Promise(o=>e.oncomplete=()=>o(!0))}async function A(){const e=(await f()).transaction(r,"readonly").objectStore(r),t=[],o=s=>{s&&(s.synced===!1||s.synced===0)&&t.push(s)},d=e.indexNames.contains("synced");return new Promise(s=>{if(d)try{const h=e.index("synced").openCursor(IDBKeyRange.only(!1));h.onsuccess=l=>{const y=l.target.result;y?(o(y.value),y.continue()):s(t)},h.onerror=()=>{const l=e.getAll();l.onsuccess=()=>{(l.result||[]).forEach(o),s(t)},l.onerror=()=>s(t)};return}catch(b){console.warn("Index open error:",b.message)}const w=e.getAll();w.onsuccess=()=>{(w.result||[]).forEach(o),s(t)},w.onerror=()=>s(t)})}async function B(n){const e=(await f()).transaction(r,"readwrite");return e.objectStore(r).delete(n),new Promise(t=>e.oncomplete=()=>t(!0))}export{u as A,j as a,A as b,I as c,E as d,g,f as o,B as r,P as s};
